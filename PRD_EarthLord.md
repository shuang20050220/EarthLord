# EarthLord 产品需求文档 (PRD)

## 文档信息

| 项目 | 内容 |
|------|------|
| 产品名称 | EarthLord (地球领主) |
| 版本 | 1.0 |
| 平台 | iOS |
| 文档创建日期 | 2026-01-09 |

---

## 1. 产品概述

### 1.1 产品定位

EarthLord 是一款基于真实地理位置的末日生存策略游戏，玩家通过实际行走来圈占领地、探索废墟、搜刮资源，在末世中重建文明。

### 1.2 核心价值主张

- **Walk to Earn**: 用双脚丈量土地，真实行走获得游戏资源
- **希望朋克**: 在废土之上重建希望，融合生存与建设元素
- **LBS社交**: 基于位置的玩家互动和资源交易

### 1.3 目标用户

| 用户类型 | 特征描述 |
|----------|----------|
| 核心用户 | 18-35岁，喜欢户外运动、生存游戏的玩家 |
| 次级用户 | 运动爱好者，希望游戏化激励日常步行 |
| 潜在用户 | 策略游戏玩家，对末日题材感兴趣的用户 |

### 1.4 商业目标

- 通过订阅制和内购实现商业变现
- 面向全球175个国家/地区发布（多语言支持）
- 构建活跃的玩家社区生态

---

## 2. 产品架构

### 2.1 核心循环

```
登录注册 → 圈地占领 → 探索搜刮 → 获得资源
    ↑                              ↓
    │         ┌──────────────────────────┐
    │         │  资源用途：                │
    │         │  • 建造建筑（消耗资源）      │
    │         │  • 交易换物（流通资源）      │
    │         │  • 生存消耗（食物/水）       │
    │         └──────────────────────────┘
    │                              ↓
    └──────── 通讯社交 ← 成就排行 ← 发展壮大
```

### 2.2 功能模块架构

| 模块 | 子功能 | 优先级 |
|------|--------|--------|
| 用户系统 | 登录注册、个人档案、设置 | P0 |
| 领地系统 | GPS圈地、领地管理、领地验证 | P0 |
| 探索系统 | POI发现、搜刮机制、地理围栏 | P0 |
| 资源系统 | 背包管理、物品分类、容量限制 | P0 |
| 建造系统 | 建筑建造、状态管理、升级机制 | P1 |
| 交易系统 | 挂单、接单、物物交换 | P1 |
| 通讯系统 | 消息中心、公共频道、私有频道、PTT | P1 |
| 商业化 | 订阅、内购、会员特权 | P1 |
| 成长系统 | 成就、排行榜、生存体征 | P2 |

---

## 3. 功能需求详述

### 3.1 用户系统

#### 3.1.1 登录注册

**功能描述**: 支持多种方式的用户身份验证

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| AUTH-001 | 支持邮箱+密码注册登录 | P0 |
| AUTH-002 | 支持 Apple ID 一键登录 | P0 |
| AUTH-003 | 支持 Google 账号登录 | P0 |
| AUTH-004 | 邮箱验证功能 | P1 |
| AUTH-005 | 密码重置功能 | P1 |
| AUTH-006 | 会话管理（多设备登录） | P1 |

**技术实现**: Supabase Auth

#### 3.1.2 个人档案

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| PROF-001 | 展示玩家基础信息（头像、昵称） | P0 |
| PROF-002 | 展示游戏统计（存活天数、领地数、总面积） | P0 |
| PROF-003 | 展示幸存者等级 | P1 |

#### 3.1.3 设置

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| SET-001 | 多语言切换（中文简体/繁体、English） | P0 |
| SET-002 | 通知设置 | P1 |
| SET-003 | 账号管理 | P1 |

---

### 3.2 领地系统

#### 3.2.1 GPS圈地

**功能描述**: 玩家通过实际行走绘制领地边界

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| TERR-001 | 实时GPS轨迹绘制（蓝色路径线） | P0 |
| TERR-002 | 路径自动闭合检测（回到起点附近） | P0 |
| TERR-003 | 闭合后生成多边形领地（绿色填充） | P0 |
| TERR-004 | 领地面积计算与展示 | P0 |
| TERR-005 | 反作弊验证（速度/轨迹异常检测） | P0 |
| TERR-006 | 领地重叠检测 | P0 |

**技术实现**: Apple MapKit + CoreLocation + PostGIS

#### 3.2.2 领地管理

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| TERR-007 | 领地命名功能 | P0 |
| TERR-008 | 领地详情查看（面积、建筑数量） | P0 |
| TERR-009 | 允许交易开关 | P1 |
| TERR-010 | 领地活跃度检测（30天建设/90天活跃规则） | P2 |

---

### 3.3 探索系统

#### 3.3.1 POI发现

**功能描述**: 基于真实地理位置的兴趣点发现

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| POI-001 | 自动识别附近真实POI | P0 |
| POI-002 | POI分类映射资源类型 | P0 |
| POI-003 | 地理围栏触发（进入范围提示） | P0 |
| POI-004 | 搜刮冷却机制 | P1 |

**POI-资源映射表**:

| POI类型 | 产出资源 |
|---------|----------|
| 医院/药店 | 药品（急救包、抗生素） |
| 超市/餐厅 | 食物（罐头、饮用水） |
| 工厂/工地 | 金属材料 |
| 公园/林地 | 木材 |
| 银行/珠宝店 | 稀有材料 |

#### 3.3.2 探索成就

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| EXP-001 | 探索距离统计 | P0 |
| EXP-002 | 探索时长统计 | P0 |
| EXP-003 | 搜刮物品结算展示 | P0 |

---

### 3.4 资源系统

#### 3.4.1 背包管理

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| INV-001 | 背包容量显示（已用/上限） | P0 |
| INV-002 | 物品列表展示（图标、名称、数量） | P0 |
| INV-003 | 物品分类筛选 | P1 |
| INV-004 | 物品使用功能 | P1 |
| INV-005 | 本地优先存储+云端同步 | P0 |

---

### 3.5 建造系统

#### 3.5.1 建筑建造

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| BUILD-001 | 建筑分类浏览（生存/储存/生产/能源） | P0 |
| BUILD-002 | 建筑详情展示（所需资源） | P0 |
| BUILD-003 | 资源扣除检验 | P0 |
| BUILD-004 | 拖拽选择建造位置 | P0 |
| BUILD-005 | 资源不足提示 | P0 |

**建筑分类**:

| 分类 | 建筑举例 | 功能 |
|------|----------|------|
| 生存 | 篝火、庇护所 | 基础生存需求 |
| 储存 | 小仓库、中仓库 | 扩展存储空间 |
| 生产 | 农田、工作台 | 持续产出资源 |
| 能源 | 太阳能板、风力发电机 | 提供电力 |

#### 3.5.2 建筑状态

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| BUILD-006 | 建筑状态机（建造中→待激活→运行中→损坏） | P0 |
| BUILD-007 | 状态约束操作（如：仅运行中可升级） | P0 |
| BUILD-008 | 建筑升级功能（Tier 1→2→3） | P1 |
| BUILD-009 | 建筑维修功能 | P1 |

---

### 3.6 交易系统

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| TRADE-001 | 发布挂单（我提供/我需要） | P0 |
| TRADE-002 | 浏览附近挂单（100米范围内） | P0 |
| TRADE-003 | 接受交易 | P0 |
| TRADE-004 | 交易历史记录 | P1 |

---

### 3.7 通讯系统

#### 3.7.1 消息中心

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| MSG-001 | 官方消息推送 | P0 |
| MSG-002 | 系统通知 | P0 |
| MSG-003 | 消息已读状态 | P1 |

#### 3.7.2 公共频道

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| CHAT-001 | 基于位置的公共聊天室（3km范围） | P0 |
| CHAT-002 | 实时消息推送 | P0 |
| CHAT-003 | 消息发送/接收 | P0 |

**技术实现**: Supabase Realtime

#### 3.7.3 频道管理

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| CHAN-001 | 频道列表浏览 | P0 |
| CHAN-002 | 创建频道 | P1 |
| CHAN-003 | 加入/退出频道 | P0 |
| CHAN-004 | 频道内聊天 | P0 |

#### 3.7.4 PTT呼叫

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| PTT-001 | 长按发送语音消息 | P1 |
| PTT-002 | 频率切换 | P1 |

#### 3.7.5 通讯设备等级

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| DEV-001 | 设备等级系统（收音机→对讲机→营地电台→卫星通讯） | P1 |
| DEV-002 | 等级限制功能（收音机只能接收） | P1 |
| DEV-003 | 设备升级功能 | P1 |

**设备能力矩阵**:

| 设备 | 发送能力 | 覆盖范围 |
|------|----------|----------|
| 收音机 | 仅接收 | - |
| 对讲机 | 可收发 | 3km |
| 营地电台 | 可收发 | 10km |
| 卫星通讯 | 可收发 | 全球 |

---

### 3.8 商业化系统

#### 3.8.1 订阅服务

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| SUB-001 | 开拓者月卡 $9.99/月 | P0 |
| SUB-002 | 领主通行证 $19.99/月 | P0 |
| SUB-003 | 订阅权益展示 | P0 |
| SUB-004 | 自动续费管理 | P0 |

#### 3.8.2 资源包内购

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| IAP-001 | 初级物资包 $0.99 | P0 |
| IAP-002 | 中级物资包 $2.99 | P0 |
| IAP-003 | 稀有资源包 $9.99 | P0 |

**技术实现**: StoreKit 2

---

### 3.9 成长系统

#### 3.9.1 排行榜

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| RANK-001 | 领地面积榜 | P1 |
| RANK-002 | 探索废墟榜 | P1 |
| RANK-003 | 建筑数量榜 | P1 |
| RANK-004 | 个人排名展示 | P1 |
| RANK-005 | 排行榜缓存（5分钟更新） | P1 |

#### 3.9.2 成就系统

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| ACH-001 | 成就分类（新手/进阶/稀有） | P1 |
| ACH-002 | 成就进度追踪 | P1 |
| ACH-003 | 成就完成奖励（金币） | P1 |
| ACH-004 | 成就稀有度（普通→稀有→史诗→传说） | P2 |

**技术实现**: EventBus (发布-订阅模式)

#### 3.9.3 生存体征

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| VITAL-001 | 核心生命值展示 | P1 |
| VITAL-002 | 饱食度展示与衰减（每小时-5） | P1 |
| VITAL-003 | 水分展示与衰减（每小时-10） | P1 |
| VITAL-004 | 高状态增益（>80%时获得buff） | P2 |
| VITAL-005 | 物品恢复体征 | P1 |

---

## 4. 非功能需求

### 4.1 性能需求

| 需求项 | 指标 |
|--------|------|
| GPS定位精度 | ≤10米 |
| 消息推送延迟 | ≤2秒 |
| 排行榜查询 | ≤1秒（支持10万用户） |
| App启动时间 | ≤3秒 |

### 4.2 安全需求

| 需求项 | 描述 |
|--------|------|
| 数据传输 | HTTPS加密 |
| 用户认证 | OAuth 2.0 |
| 防作弊 | GPS轨迹异常检测 |

### 4.3 可用性需求

| 需求项 | 指标 |
|--------|------|
| 离线支持 | 背包数据本地可查看 |
| 网络恢复 | 自动同步云端 |

---

## 5. 技术架构

### 5.1 前端技术栈

- **语言**: Swift
- **框架**: SwiftUI
- **地图**: Apple MapKit
- **定位**: CoreLocation
- **支付**: StoreKit 2

### 5.2 后端技术栈

- **BaaS**: Supabase
  - Authentication (用户认证)
  - Database (PostgreSQL + PostGIS)
  - Realtime (实时消息)
  - Storage (文件存储)

### 5.3 核心代码文件

| 功能模块 | 核心文件 |
|----------|----------|
| 登录注册 | AuthManager.swift |
| GPS圈地 | LocationManager.swift |
| 领地管理 | TerritoryManager.swift |
| POI发现 | POIManager.swift |
| 探索搜刮 | ExplorationManager.swift |
| 背包系统 | ItemManager.swift |
| 建造系统 | BuildingManager.swift |
| 交易系统 | TradeManager.swift |
| 消息中心 | RadioManager.swift |
| 实时聊天 | CommunicationManager.swift |
| 频道管理 | ChannelManager.swift |
| 内购支付 | StoreKitManager.swift |
| 排行榜 | LeaderboardManager.swift |
| 成就系统 | AchievementManager.swift |
| 生存体征 | VitalSignsManagerV2.swift |

---

## 6. 发布计划

### 6.1 MVP版本 (v1.0)

**包含功能**:
- 用户系统（登录注册）
- 领地系统（GPS圈地、领地管理）
- 探索系统（POI发现、搜刮）
- 资源系统（背包管理）
- 建造系统（基础建筑）
- 通讯系统（公共频道）
- 商业化（订阅+内购）

### 6.2 后续迭代

- v1.1: 交易系统完善、频道管理
- v1.2: 成就系统、排行榜
- v1.3: PTT语音、设备升级
- v2.0: 联盟系统、领地战争

---

## 7. 成功指标

| 指标类型 | 具体指标 | 目标值 |
|----------|----------|--------|
| 用户获取 | DAU | 10,000+ |
| 用户留存 | 7日留存率 | ≥30% |
| 用户活跃 | 日均使用时长 | ≥20分钟 |
| 商业化 | 付费转化率 | ≥3% |
| 商业化 | ARPU | $5+ |

---

*文档结束*
